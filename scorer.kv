#:kivy 2.3.0
#:import TextInput kivy.uix.textinput.TextInput
#:import Factory kivy.factory.Factory
#:import StringProperty kivy.properties.StringProperty

# Define some global properties based on the CSS for reusability
<InterBlack@Label>:
    font_name: 'InterBlack'
    color: 1, 1, 1, 1 # Default white text

<ScoreboardButton@Button>:
    font_name: 'InterBlack'
    background_color: 1, 1, 1, 1    # White background
    color: 0, 0, 0, 1                # Black text
    size_hint_y: None
    height: dp(35) # Adjust as needed, similar to CSS padding/font size
    padding: [dp(5), dp(5)] # Approximate CSS padding
    # For Kivy Button, background_normal and background_down are usually images.
    # To get a solid color, we draw on the canvas.
    canvas.before:
        Color:
            rgba: self.background_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(5)] # Direct value to fix the TypeError
    # Reset Kivy's default button image backgrounds
    background_normal: ''
    background_down: ''


<HeaderLayout@BoxLayout>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(55) # Adjusted height slightly
    padding: dp(5)
    spacing: dp(10)
    title_text: ''
    canvas.before:
        Color:
            rgba: 0.1, 0.1, 0.15, 1 # Slightly different header background
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'assets/icon_64.png'
        size_hint_x: None
        width: self.height # Keep it square based on header height
    Label:
        id: header_title
        text: root.title_text # root.title_text will be provided when HeaderLayout is used
        font_size: '22sp'
        bold: True
        halign: 'left'
        valign: 'middle'
        text_size: self.width, None
        size_hint_x: 0.8 # Allow label to take most space
    Button:
        text: 'X'
        font_size: '20sp'
        size_hint_x: None
        width: dp(50) # Fixed width for the close button
        on_press: app.stop() # Call app.stop() to exit

ScreenManager:
    SplashScreen: # Added SplashScreen
    ResumeOrNewScreen: # Added ResumeOrNewScreen
    NameEntryScreen:
    DeploymentSetupScreen:
    FirstTurnSetupScreen:
    ScorerRootWidget:
    GameOverScreen:

<NameEntryScreen>:
    name: 'name_entry'
    player1_name_input: p1_name_entry_input
    player2_name_input: p2_name_entry_input
    continue_button: name_entry_continue_btn

    BoxLayout: # New Main Root for NameEntryScreen
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Player Name Entry' # Set the property of HeaderLayout
        # Original Root BoxLayout for NameEntryScreen content
        BoxLayout: 
            orientation: 'vertical'
            padding: dp(20)
            spacing: dp(15)
            # Label for 'Enter Player Names' is now in HeaderLayout
            # Remove the old title Label from here if it exists directly
            # The old title Label:
            # Label:
            #     text: 'Enter Player Names'
            #     font_size: '28sp'
            #     size_hint_y: None
            #     height: dp(40)
            #     bold: True
            #     halign: 'center'

            BoxLayout: # Two-column layout for name inputs
                orientation: 'horizontal'
                spacing: dp(15)
                size_hint_y: 0.3 # Give some proportional height

                # Player 1 Column
                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(10)
                    spacing: dp(8)
                    canvas.before:
                        Color:
                            rgba: 0.1, 0.1, 0.1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        text: "Player 1 Name"
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    TextInput:
                        id: p1_name_entry_input
                        text: 'Player 1'
                        font_size: '20sp'
                        multiline: False
                        on_text_validate: root.on_text_validate_p1(self)
                        on_text: root.on_name_input(self, self.text)
                        size_hint_y: None
                        height: dp(40)

                # Player 2 Column
                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(10)
                    spacing: dp(8)
                    canvas.before:
                        Color:
                            rgba: 0.1, 0.1, 0.1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        text: "Player 2 Name"
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    TextInput:
                        id: p2_name_entry_input
                        text: 'Player 2'
                        font_size: '20sp'
                        multiline: False
                        on_text_validate: root.on_text_validate_p2(self)
                        on_text: root.on_name_input(self, self.text)
                        size_hint_y: None
                        height: dp(40)

            Widget: # Spacer to push button to bottom
                size_hint_y: 0.7 # Adjust as needed
            
            Button:
                id: name_entry_continue_btn
                text: 'Continue to Deployment Setup'
                font_size: '22sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.save_names_and_proceed()
                disabled: True

<DeploymentSetupScreen>:
    name: 'deployment_setup'
    p1_name_label: p1_name_dsp_lbl
    p1_roll_button: p1_roll_dsp_btn
    p1_roll_display_label: p1_roll_dsp_lbl
    p1_choice_box: p1_choice_dsp_box

    p2_name_label: p2_name_dsp_lbl
    p2_roll_button: p2_roll_dsp_btn
    p2_roll_display_label: p2_roll_dsp_lbl
    p2_choice_box: p2_choice_dsp_box

    deployment_status_label: deployment_status_dsp_lbl
    continue_to_first_turn_button: continue_to_ft_btn

    BoxLayout: # New Main Root
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Deployment Setup' # Set the property
        # Original Root BoxLayout for DeploymentSetupScreen content
        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)
            # Old title Label removed from here

            Label: # Central Status Label
                id: deployment_status_dsp_lbl
                text: 'Roll for Deployment Attacker/Defender'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None

            BoxLayout: # Player Columns
                orientation: 'horizontal'
                spacing: dp(10)
                # Player 1 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        id: p1_name_dsp_lbl
                        text: 'Player 1'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p1_roll_dsp_btn
                        text: 'Roll P1 Deploy'
                        on_press: root.roll_deployment_initiative(1)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p1_roll_dsp_lbl
                        text: 'P1 Deploy: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P1 Choice Box (for Attacker/Defender buttons)
                        id: p1_choice_dsp_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80) # Space for two buttons
                        spacing: dp(5)
                        opacity: 0 # Hidden initially

                # Player 2 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        id: p2_name_dsp_lbl
                        text: 'Player 2'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p2_roll_dsp_btn
                        text: 'Roll P2 Deploy'
                        on_press: root.roll_deployment_initiative(2)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p2_roll_dsp_lbl
                        text: 'P2 Deploy: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P2 Choice Box
                        id: p2_choice_dsp_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80)
                        spacing: dp(5)
                        opacity: 0
            
            Widget: # Spacer
                size_hint_y: 0.1

            Label:
                text: "(After Attacker/Defender is chosen, deploy your armies on the tabletop.)"
                font_size: '14sp'
                italic: True
                size_hint_y: None
                height: dp(25)
                halign: 'center'

            Widget: # Spacer
                size_hint_y: 1

            Button:
                id: continue_to_ft_btn
                text: 'Units Deployed - Continue to First Turn Roll'
                font_size: '20sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.proceed_to_first_turn_setup()
                disabled: True


<FirstTurnSetupScreen>:
    name: 'first_turn_setup'
    p1_name_label: p1_name_ft_lbl
    p1_ft_roll_button: p1_roll_ft_btn
    p1_ft_roll_display_label: p1_roll_ft_lbl
    p1_ft_choice_box: p1_choice_ft_box

    p2_name_label: p2_name_ft_lbl
    p2_ft_roll_button: p2_roll_ft_btn
    p2_ft_roll_display_label: p2_roll_ft_lbl
    p2_ft_choice_box: p2_choice_ft_box
    
    first_turn_status_label: first_turn_status_ft_lbl
    start_game_button: start_game_ft_btn

    BoxLayout: # New Main Root
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'First Turn Setup' # Set the property
        # Original Root BoxLayout for FirstTurnSetupScreen content
        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)
            # Old title Label removed from here

            Label: # Central Status Label
                id: first_turn_status_ft_lbl
                text: 'Roll for First Turn!'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None

            BoxLayout: # Player Columns
                orientation: 'horizontal'
                spacing: dp(10)
                # Player 1 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        id: p1_name_ft_lbl
                        text: 'Player 1'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p1_roll_ft_btn
                        text: 'Roll P1 First Turn'
                        on_press: root.roll_first_turn_initiative(1)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p1_roll_ft_lbl
                        text: 'P1 First Turn: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P1 First Turn Choice Box
                        id: p1_choice_ft_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80) # Space for two buttons
                        spacing: dp(5)
                        opacity: 0 # Hidden initially

                # Player 2 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        id: p2_name_ft_lbl
                        text: 'Player 2'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p2_roll_ft_btn
                        text: 'Roll P2 First Turn'
                        on_press: root.roll_first_turn_initiative(2)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p2_roll_ft_lbl
                        text: 'P2 First Turn: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P2 First Turn Choice Box
                        id: p2_choice_ft_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80)
                        spacing: dp(5)
                        opacity: 0
            
            Widget: # Spacer
                size_hint_y: 1

            Button:
                id: start_game_ft_btn
                text: 'Start Game'
                font_size: '22sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.start_game_action()
                disabled: True


<ScorerRootWidget>:
    name: 'scorer_root'
    # These ObjectProperties need to be in main.py for ScorerRootWidget class
    # Header elements
    header_round_label: header_round_label_id
    header_total_time_label: header_total_time_label_id
    # P1 elements
    p1_name_label: p1_name_label_id
    p1_score_label: p1_score_label_id
    p1_cp_label: p1_cp_label_id
    p1_player_timer_label: p1_player_timer_label_id # Changed from p1_player_timer_id
    p1_end_turn_button: p1_end_turn_button_id
    # P2 elements
    p2_name_label: p2_name_label_id
    p2_score_label: p2_score_label_id
    p2_cp_label: p2_cp_label_id
    p2_player_timer_label: p2_player_timer_label_id # Changed from p2_player_timer_id
    p2_end_turn_button: p2_end_turn_button_id # NEW: Explicitly map the ObjectProperty to the id

    canvas.before:
        Color:
            rgba: 1, 1, 1, 1 # Opaque white, so image is not tinted
        Rectangle:
            source: 'assets/background.png'
            pos: self.pos
            size: self.size

    BoxLayout: # Main vertical layout for the whole screen
        orientation: 'vertical'
        #padding: dp(5) # CSS .screen has no padding, background does it all

        # Header section (Kivy: BoxLayout, orientation: 'horizontal', children aligned vertically center, space-between distribution)
        BoxLayout:
            id: scoreboard_header_id # New ID for the header
            size_hint_y: None
            height: dp(48) # From CSS .header height
            # Background color is black in CSS, but here we want the main background.png to show
            # If a distinct header background is needed on top of background.png, add canvas instructions here.
            # For now, assuming header elements are directly on the main background image sections.
            padding: [dp(10), 0, dp(20), 0] # Approximate (left, top, right, bottom) gap/padding seen in CSS
            spacing: dp(20) # From CSS .header gap

            # Logo group (Kivy: BoxLayout, orientation: 'horizontal', children aligned vertically center)
            BoxLayout:
                size_hint_x: None
                width: self.height + dp(60) # icon width + text guess
                spacing: dp(10) # From CSS .logo gap
                Image:
                    source: 'assets/icon_48.png' # Path from HTML
                    size_hint_x: None
                    width: dp(48) # Assuming square from name
                    height: dp(48)
                InterBlack:
                    text: 'Scorer'
                    font_size: '18sp' # From CSS .header font-size
                    valign: 'middle'

            # Round Label (Kivy: Label for Round)
            InterBlack:
                id: header_round_label_id
                text: 'Round 1' # Placeholder
                font_size: '18sp' # From CSS .header font-size
                size_hint_x: 1 # Take available space to push time to right
                halign: 'center' # Center the round text
                valign: 'middle'

            # Total Time Label (Kivy: Label for Total Time)
            InterBlack:
                id: header_total_time_label_id
                text: 'Total Time: 00:00:00' # Placeholder
                font_size: '18sp' # From CSS .header font-size
                size_hint_x: None # Take its own width
                width: dp(200) # Estimate to fit text
                halign: 'right' # Align to the right (padding_right was on .total_time in CSS)
                valign: 'middle'

        # Players Area (Kivy: Main content for players. CSS suggests: GridLayout, cols: 2.)
        GridLayout:
            cols: 2
            # spacing: dp(0) # No spacing between red/blue panels as background image handles the split

            # Red Player Panel Area (Grid cell 1)
            # (Kivy: Inner Red Player Panel. CSS suggests: BoxLayout, orientation: 'vertical', children aligned to start (left), with padding and spacing.)
            BoxLayout:
                id: p1_panel_id
                orientation: 'vertical'
                padding: dp(20) # From CSS .player_red_panel padding
                spacing: dp(10) # From CSS .player_red_panel gap
                # Background is handled by the main screen image

                InterBlack:
                    id: p1_name_label_id
                    text: 'Player 1 - Active' # Placeholder
                    font_size: '24sp' # From CSS .player_name
                    halign: 'left'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                InterBlack:
                    id: p1_score_label_id
                    text: '0' # Placeholder
                    font_size: '96sp' # From CSS .player_score
                    halign: 'left'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                InterBlack:
                    id: p1_cp_label_id
                    text: 'Command Points: 0' # Placeholder
                    font_size: '18sp' # From CSS .player_cp
                    halign: 'left'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                InterBlack:
                    id: p1_player_timer_label_id # Matched to Python ObjectProperty
                    text: '00:00:00' # Placeholder
                    font_size: '18sp' # From CSS .player_time
                    halign: 'left'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                Widget: # Spacer to push UI to bottom
                    size_hint_y: 1

                # UI controls container (Kivy: BoxLayout, orientation: 'vertical', children aligned center horizontally)
                BoxLayout:
                    id: p1_ui_controls_id
                    orientation: 'vertical'
                    spacing: dp(20) # From CSS .ui gap
                    size_hint_y: None
                    height: self.minimum_height # Adjust to content

                    # End Turn button container
                    BoxLayout: # To center the button if ScoreboardButton itself doesn't fill width
                        size_hint_y: None
                        height: dp(35)
                        ScoreboardButton:
                            id: p1_end_turn_button_id
                            text: 'End Turn'
                            on_press: root.end_turn() # Assuming player 1 is ID 1
                            size_hint_x: 0.6 # Centered
                            pos_hint: {'center_x': 0.5}


                    # Settings group (Kivy: BoxLayout, orientation: 'horizontal', children aligned vertically center, space-between distribution)
                    BoxLayout:
                        id: p1_settings_id
                        orientation: 'horizontal'
                        spacing: dp(20) # From CSS .settings gap
                        size_hint_y: None
                        height: dp(35) # Match button height

                        ScoreboardButton:
                            id: p1_set_score_button_id
                            text: 'Set Score'
                            on_press: root.open_score_numpad(1)
                            size_hint_x: 1 # Takes up proportional space

                        # Set CP group (Kivy: BoxLayout, orientation: 'horizontal', children aligned vertically center, centered distribution)
                        BoxLayout:
                            id: p1_set_cp_id
                            orientation: 'horizontal'
                            spacing: dp(10) # From CSS .set_cp gap
                            size_hint_x: 1 # Takes up proportional space
                            ScoreboardButton:
                                text: '-1'
                                on_press: root.remove_cp(1)
                            InterBlack:
                                text: 'CP'
                                font_size: '18sp' # From CSS .set_cp font-size
                                size_hint_x: None
                                width: dp(30)
                                halign: 'center'
                                valign: 'middle'
                            ScoreboardButton:
                                text: '+1'
                                on_press: root.add_cp(1)

            # Blue Player Panel Area (Grid cell 2)
            # (Kivy: Inner Blue Player Panel. CSS suggests: BoxLayout, orientation: 'vertical', children aligned to end (right), with padding and spacing.)
            BoxLayout:
                id: p2_panel_id
                orientation: 'vertical'
                padding: dp(20) # From CSS .player_blue_panel padding
                spacing: dp(10) # From CSS .player_blue_panel gap
                # Background is handled by the main screen image

                InterBlack:
                    id: p2_name_label_id
                    text: 'Player 2' # Placeholder
                    font_size: '24sp' # From CSS .player_name
                    halign: 'right' # Aligned to end (right)
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                InterBlack:
                    id: p2_score_label_id
                    text: '0' # Placeholder
                    font_size: '96sp' # From CSS .player_score
                    halign: 'right'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                InterBlack:
                    id: p2_cp_label_id
                    text: 'Command Points: 0' # Placeholder
                    font_size: '18sp' # From CSS .player_cp
                    halign: 'right'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                InterBlack:
                    id: p2_player_timer_label_id # Matched to Python ObjectProperty
                    text: '00:00:00' # Placeholder
                    font_size: '18sp' # From CSS .player_time
                    halign: 'right'
                    valign: 'top'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(5)

                Widget: # Spacer to push UI to bottom
                    size_hint_y: 1

                # UI controls container (Kivy: BoxLayout, orientation: 'vertical', children aligned center horizontally)
                BoxLayout:
                    id: p2_ui_controls_id
                    orientation: 'vertical'
                    spacing: dp(20) # From CSS .ui gap (same as p1)
                    size_hint_y: None
                    height: self.minimum_height # Adjust to content
                    # Note: No 'end_turn' for P2 in the provided HTML structure

                    # End Turn button container for P2 (NEW)
                    BoxLayout: # To center the button
                        size_hint_y: None
                        height: dp(35)
                        ScoreboardButton:
                            id: p2_end_turn_button_id # New ID for P2's button
                            text: 'End Turn'
                            on_press: root.end_turn() # Python method handles active player
                            size_hint_x: 0.6 # Centered
                            pos_hint: {'center_x': 0.5}
                            opacity: 0 # Initially hidden, Python will control
                            disabled: True # Initially disabled

                    # Settings group (Kivy: BoxLayout, orientation: 'horizontal', children aligned vertically center, space-between distribution)
                    BoxLayout:
                        id: p2_settings_id
                        orientation: 'horizontal'
                        spacing: dp(20) # From CSS .settings gap
                        size_hint_y: None
                        height: dp(35)

                        ScoreboardButton:
                            id: p2_set_score_button_id
                            text: 'Set Score'
                            on_press: root.open_score_numpad(2)
                            size_hint_x: 1

                        # Set CP group (Kivy: BoxLayout, orientation: 'horizontal', children aligned vertically center, centered distribution)
                        BoxLayout:
                            id: p2_set_cp_id
                            orientation: 'horizontal'
                            spacing: dp(10) # From CSS .set_cp gap
                            size_hint_x: 1
                            ScoreboardButton:
                                text: '-1'
                                on_press: root.remove_cp(2)
                            InterBlack:
                                text: 'CP'
                                font_size: '18sp'
                                size_hint_x: None
                                width: dp(30)
                                halign: 'center'
                                valign: 'middle'
                            ScoreboardButton:
                                text: '+1'
                                on_press: root.add_cp(2)


<GameOverScreen>:
    name: 'game_over'
    result_status_label: result_status_lbl
    p1_final_name_label: p1_name_final_lbl
    p1_final_score_label: p1_score_final_lbl
    p1_final_cp_label: p1_cp_final_lbl
    p1_final_time_label: p1_time_final_lbl
    p2_final_name_label: p2_name_final_lbl
    p2_final_score_label: p2_score_final_lbl
    p2_final_cp_label: p2_cp_final_lbl
    p2_final_time_label: p2_time_final_lbl
    total_game_time_label: total_time_final_lbl
    rounds_played_label: rounds_played_final_lbl
    exit_button: exit_btn_gos

    BoxLayout: # New Main Root
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Game Over' # Set the property
        # Original Root BoxLayout for GameOverScreen content
        BoxLayout:
            orientation: 'vertical'
            padding: dp(20)
            spacing: dp(10)
            # Old title Label removed from here

            Label:
                id: result_status_lbl
                text: "Determining winner..."
                font_size: '26sp'
                italic: True
                size_hint_y: None
                height: dp(40)
                halign: 'center'

            GridLayout:
                cols: 2
                spacing: dp(10)
                padding: dp(10)
                size_hint_y: 0.6 # Give it some substantial height

                # Player 1 Final Stats
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(5)
                    Label:
                        id: p1_name_final_lbl
                        text: 'Player 1:'
                        font_size: '20sp'
                        bold: True
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p1_score_final_lbl
                        text: 'Score: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p1_cp_final_lbl
                        text: 'CP: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p1_time_final_lbl
                        text: 'Time: 00:00:00'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None

                # Player 2 Final Stats
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(5)
                    Label:
                        id: p2_name_final_lbl
                        text: 'Player 2:'
                        font_size: '20sp'
                        bold: True
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p2_score_final_lbl
                        text: 'Score: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p2_cp_final_lbl
                        text: 'CP: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p2_time_final_lbl
                        text: 'Time: 00:00:00'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
            
            Label: # Spacer to push game stats and buttons down a bit
                size_hint_y: 0.1

            # Overall Game Stats
            Label:
                id: total_time_final_lbl
                text: 'Total Game Time: 00:00:00'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'
            Label:
                id: rounds_played_final_lbl
                text: 'Rounds Played: 5'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'

            Widget: # Spacer
                size_hint_y: 0.3

            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: dp(50)
                spacing: dp(20)
                Button:
                    text: 'Start New Game'
                    font_size: '20sp'
                    on_press: root.start_new_game()
                Button:
                    id: exit_btn_gos
                    text: 'Exit Application'
                    font_size: '20sp'
                    on_press: root.exit_app_from_game_over()

<SplashScreen>: # Definition for SplashScreen
    name: 'splash_screen'
    BoxLayout:
        orientation: 'vertical'
        padding: dp(50) # Add some padding around the logo
        canvas.before:
            Color:
                rgba: 0.05, 0.05, 0.1, 1 # Dark background for splash
            Rectangle:
                pos: self.pos
                size: self.size
        Image:
            source: 'assets/logo-original.png'
            # allow_stretch: True  # Deprecated
            # keep_ratio: True     # Deprecated
            fit_mode: 'contain' # Use fit_mode instead 

<ResumeOrNewScreen>:
    name: 'resume_or_new'
    resume_info_label: resume_info_lbl
    resume_button: resume_btn
    new_game_button: new_game_btn_resume_screen

    BoxLayout:
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Game Found'
        BoxLayout:
            orientation: 'vertical'
            padding: dp(40)
            spacing: dp(20)
            Label:
                id: resume_info_lbl
                text: "Saved game data found. What would you like to do?"
                font_size: '20sp'
                halign: 'center'
                valign: 'middle'
                text_size: self.width - dp(20), None # Allow text wrapping
                size_hint_y: 0.4

            Button:
                id: resume_btn
                text: 'Resume Saved Game'
                font_size: '22sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.resume_game_action()
            
            Button:
                id: new_game_btn_resume_screen
                text: 'Start New Game'
                font_size: '22sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.start_new_game_from_resume_screen_action()
            
            Widget:
                size_hint_y: 0.2 # Some spacing at the bottom 