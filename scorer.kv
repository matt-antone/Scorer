#:kivy 2.3.0
#:import TextInput kivy.uix.textinput.TextInput
#:import Factory kivy.factory.Factory
#:import StringProperty kivy.properties.StringProperty
#:import 'screens.splash_screen'

# Define some global properties based on the CSS for reusability
<InterBlack@Label>:
    font_name: 'InterBlack'
    color: 1, 1, 1, 1 # Default white text

<ScoreboardButton@Button>:
    font_name: 'InterBlack'
    background_color: 0, 0, 0, 0    # Button's own background transparent
    color: 0, 0, 0, 1                # Black text
    size_hint_y: None
    height: dp(35) # Adjust as needed, similar to CSS padding/font size
    padding: [dp(5), dp(5)] # Approximate CSS padding
    # For Kivy Button, background_normal and background_down are usually images.
    # To get a solid color, we draw on the canvas.
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1            # Explicitly white for the RoundedRectangle
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10)]
    # Reset Kivy's default button image backgrounds
    background_normal: ''
    background_down: ''

<Player1Button@ScoreboardButton>:
    color: 1, 1, 1, 1 # White text
    canvas.before:
        Color:
            rgba: 1, 0, 0, 1 # Red background (#FF0000)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10)]

<Player2Button@ScoreboardButton>:
    color: 1, 1, 1, 1 # White text
    canvas.before:
        Color:
            rgba: 0, 0.349, 1, 1 # Blue background (#0059FF)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10)]

<HeaderLayout@BoxLayout>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(55) # Adjusted height slightly
    padding: dp(5)
    spacing: dp(10)
    title_text: ''
    canvas.before:
        Color:
            rgba: 0.1, 0.1, 0.15, 1 # Slightly different header background
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'assets/icon_64.png'
        size_hint_x: None
        width: self.height # Keep it square based on header height
    Label:
        id: header_title
        text: root.title_text # root.title_text will be provided when HeaderLayout is used
        font_size: '22sp'
        bold: True
        halign: 'left'
        valign: 'middle'
        text_size: self.width, None
        size_hint_x: 0.8 # Allow label to take most space
    Button:
        font_name: 'InterBlack'
        font_size: '20sp'
        text: 'New Game'
        on_press: root.request_new_game()
    Button:
        font_name: 'InterBlack'
        font_size: '20sp'
        text: 'Exit'
        on_press: root.exit_app()

ScreenManager:
    SplashScreen: # Added SplashScreen
    ResumeOrNewScreen: # Added ResumeOrNewScreen
    NameEntryScreen:
    DeploymentSetupScreen:
    FirstTurnSetupScreen:
    ScorerRootWidget:
    GameOverScreen:
    ScreensaverScreen:

<NameEntryScreen>:
    name: 'name_entry'
    player1_name_input: player1_name_input
    player2_name_input: player2_name_input
    p1_qr_code: p1_qr_code
    p2_qr_code: p2_qr_code
    continue_button: continue_button

    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            source: 'assets/background.png'
            pos: self.pos
            size: self.size

    BoxLayout: # Main Root for NameEntryScreen
        id: main_layout
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Player Name Entry'

        ScrollView:
            do_scroll_x: False
            GridLayout:
                cols: 2
                padding: dp(20)
                spacing: dp(20)
                size_hint_y: None
                height: self.minimum_height

                # Player 1 Column
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    size_hint_y: None
                    height: self.minimum_height
                    Label:
                        text: "Player 1 Name"
                        font_name: 'InterBlack'
                        font_size: '20sp'
                        size_hint_y: None
                        height: self.texture_size[1]
                    TextInput:
                        id: player1_name_input
                        text: 'Player 1'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(40)
                        multiline: False
                        on_focus: root.set_active_input(self)
                        on_text_validate: root.on_text_validate_p1()
                    Image:
                        id: p1_qr_code
                        size_hint_y: None
                        height: dp(150)
                        width: dp(150)
                        allow_stretch: True

                # Player 2 Column
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    size_hint_y: None
                    height: self.minimum_height
                    Label:
                        text: "Player 2 Name"
                        font_name: 'InterBlack'
                        font_size: '20sp'
                        size_hint_y: None
                        height: self.texture_size[1]
                    TextInput:
                        id: player2_name_input
                        text: 'Player 2'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(40)
                        multiline: False
                        on_focus: root.set_active_input(self)
                        on_text_validate: root.on_text_validate_p2()
                    Image:
                        id: p2_qr_code
                        size_hint_y: None
                        height: dp(150)
                        width: dp(150)
                        allow_stretch: True

        BoxLayout:
            size_hint_y: None
            height: dp(60)
            padding: [dp(20), 0, dp(20), dp(10)]
            Button:
                id: continue_button
                text: 'Continue'
                font_name: 'InterBlack'
                font_size: '22sp'
                size_hint: (1, 1)
                on_press: root.save_names_and_proceed()
                disabled: False

<DeploymentSetupScreen>:
    name: 'deployment_setup'
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            source: 'assets/background.png'
            pos: self.pos
            size: self.size
    p1_name_label: p1_name_dsp_lbl
    p1_roll_button: p1_roll_dsp_btn
    p1_roll_display_label: p1_roll_dsp_lbl
    p1_choice_box: p1_choice_dsp_box

    p2_name_label: p2_name_dsp_lbl
    p2_roll_button: p2_roll_dsp_btn
    p2_roll_display_label: p2_roll_dsp_lbl
    p2_choice_box: p2_choice_dsp_box

    deployment_status_label: deployment_status_dsp_lbl
    continue_to_first_turn_button: continue_to_ft_btn

    BoxLayout: # New Main Root
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Deployment Setup' # Set the property
        # Original Root BoxLayout for DeploymentSetupScreen content
        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)
            # Old title Label removed from here

            Label: # Central Status Label
                id: deployment_status_dsp_lbl
                text: 'Roll for Deployment Attacker/Defender'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None

            BoxLayout: # Player Columns
                orientation: 'horizontal'
                spacing: dp(10)
                # Player 1 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        id: p1_name_dsp_lbl
                        text: 'Player 1'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p1_roll_dsp_btn
                        text: 'Roll P1 Deploy'
                        on_press: root.roll_deployment_initiative(1)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p1_roll_dsp_lbl
                        text: 'P1 Deploy: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P1 Choice Box (for Attacker/Defender buttons)
                        id: p1_choice_dsp_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80) # Space for two buttons
                        spacing: dp(5)
                        opacity: 0 # Hidden initially

                # Player 2 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        id: p2_name_dsp_lbl
                        text: 'Player 2'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p2_roll_dsp_btn
                        text: 'Roll P2 Deploy'
                        on_press: root.roll_deployment_initiative(2)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p2_roll_dsp_lbl
                        text: 'P2 Deploy: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P2 Choice Box
                        id: p2_choice_dsp_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80)
                        spacing: dp(5)
                        opacity: 0
            
            Widget: # Spacer
                size_hint_y: 0.1

            Label:
                text: "(After Attacker/Defender is chosen, deploy your armies on the tabletop.)"
                font_size: '14sp'
                italic: True
                size_hint_y: None
                height: dp(25)
                halign: 'center'

            Widget: # Spacer
                size_hint_y: 1

            Button:
                id: continue_to_ft_btn
                text: 'Units Deployed - Continue to First Turn Roll'
                font_size: '20sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.proceed_to_first_turn_setup()
                disabled: True


<FirstTurnSetupScreen>:
    name: 'first_turn_setup'
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            source: 'assets/background.png'
            pos: self.pos
            size: self.size
    p1_name_label: p1_name_ft_lbl
    p1_ft_roll_button: p1_roll_ft_btn
    p1_ft_roll_display_label: p1_roll_ft_lbl
    p1_ft_choice_box: p1_choice_ft_box

    p2_name_label: p2_name_ft_lbl
    p2_ft_roll_button: p2_roll_ft_btn
    p2_ft_roll_display_label: p2_roll_ft_lbl
    p2_ft_choice_box: p2_choice_ft_box
    
    first_turn_status_label: first_turn_status_ft_lbl
    start_game_button: start_game_ft_btn

    BoxLayout: # New Main Root
        orientation: 'vertical'
        size: self.size
        HeaderLayout:
            title_text: 'First Turn Setup' # Set the property
        # Original Root BoxLayout for FirstTurnSetupScreen content
        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)

            # Old title Label removed from here
            Label: # Central Status Label
                id: first_turn_status_ft_lbl
                text: 'Roll for First Turn!'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None

            BoxLayout: # Player Columns
                orientation: 'horizontal'
                spacing: dp(10)
                # Player 1 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    Label:
                        id: p1_name_ft_lbl
                        text: 'Player 1'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p1_roll_ft_btn
                        text: 'Roll P1 First Turn'
                        on_press: root.roll_first_turn_initiative(1)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p1_roll_ft_lbl
                        text: 'P1 First Turn: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P1 First Turn Choice Box
                        id: p1_choice_ft_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80) # Space for two buttons
                        spacing: dp(5)
                        opacity: 0 # Hidden initially

                # Player 2 Area
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.5
                    padding: dp(5)
                    spacing: dp(5)
                    Label:
                        id: p2_name_ft_lbl
                        text: 'Player 2'
                        font_size: '20sp'
                        size_hint_y: None
                        height: dp(30)
                    Button:
                        id: p2_roll_ft_btn
                        text: 'Roll P2 First Turn'
                        on_press: root.roll_first_turn_initiative(2)
                        size_hint_y: None
                        height: dp(40)
                    Label:
                        id: p2_roll_ft_lbl
                        text: 'P2 First Turn: -'
                        size_hint_y: None
                        height: dp(30)
                    BoxLayout: # P2 First Turn Choice Box
                        id: p2_choice_ft_box
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(80)
                        spacing: dp(5)
                        opacity: 0
            
            Widget: # Spacer
                size_hint_y: 1

            Button:
                id: start_game_ft_btn
                text: 'Start Game'
                font_size: '22sp'
                size_hint_y: None
                height: dp(50)
                on_press: root.start_game_action()
                disabled: True


<ScorerRootWidget>:
    name: 'scorer_root'
    # These ObjectProperties need to be in main.py for ScorerRootWidget class
    # Header elements
    header_round_label: header_round_label_id
    header_total_time_label: header_total_time_label_id
    # P1 elements
    p1_name_label: p1_name_label_id
    p1_score_label: p1_score_label_id
    p1_cp_label: p1_cp_label_id
    p1_player_timer_label: p1_player_timer_label_id
    p1_end_turn_button: p1_end_turn_button_id
    p1_concede_button: p1_concede_button_id
    # P2 elements
    p2_name_label: p2_name_label_id
    p2_score_label: p2_score_label_id
    p2_cp_label: p2_cp_label_id
    p2_player_timer_label: p2_player_timer_label_id
    p2_end_turn_button: p2_end_turn_button_id
    p2_concede_button: p2_concede_button_id

    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1 # Opaque white, so image is not tinted
            Rectangle:
                source: 'assets/background.png'
                pos: self.pos
                size: self.size

        # Main layout for header and player grid
        BoxLayout:
            orientation: 'vertical'
            # Header section
            BoxLayout:
                id: scoreboard_header_id
                size_hint_y: None
                height: dp(48)
                padding: [dp(20), 0, dp(20), 0]
                spacing: 0
                width: dp(800)
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 1 # Black background
                    Rectangle:
                        pos: self.pos
                        size: self.size

                # Round Label
                InterBlack:
                    id: header_round_label_id
                    text: 'Round 1'
                    font_size: '18sp'
                    size_hint_x: 1
                    width: dp(400)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                # Total Time Label
                InterBlack:
                    id: header_total_time_label_id
                    text: 'Total Time: 00:00:00'
                    font_size: '18sp'
                    size_hint_x: None
                    width: dp(400)
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'middle'

            # Players Area is complete. don't touch this
            GridLayout:
                cols: 2
                BoxLayout:
                    id: p1_panel_id
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(5)
                    InterBlack:
                        id: p1_name_label_id
                        text: 'Player 1 - Active'
                        font_size: '24sp'
                        text_size: self.width, None
                        halign: 'left' # Align left as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    InterBlack:
                        id: p1_score_label_id
                        text: '0'
                        font_size: '96sp'
                        text_size: self.width, None
                        halign: 'left' # Align left as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    InterBlack:
                        id: p1_cp_label_id
                        text: 'Command Points: 0'
                        font_size: '18sp'
                        text_size: self.width, None
                        halign: 'left' # Align left as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    InterBlack:
                        id: p1_player_timer_label_id
                        text: '00:00:00'
                        font_size: '18sp'
                        text_size: self.width, None
                        halign: 'left' # Align left as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    Player1Button:
                        id: p1_concede_button_id
                        text: "Concede"
                        size_hint_y: None
                        height: dp(35)
                        on_press: root.player_concedes(1)
                        opacity: 0
                        disabled: True
                    Widget:
                        size_hint_y: 1
                    BoxLayout:
                        id: p1_ui_controls_id
                        orientation: 'vertical'
                        spacing: dp(10) 
                        size_hint_y: None
                        height: self.minimum_height

                        # End Turn button container (MOVED TO TOP)
                        BoxLayout: 
                            size_hint_y: None
                            height: dp(35)
                            Player1Button:
                                id: p1_end_turn_button_id
                                text: "End Turn"
                                font_size: '16sp'
                                on_press: root.end_turn()
                                opacity: 0 
                                disabled: True

                        Player1Button:
                            id: p1_set_score_button_id
                            text: "Set Score"
                            size_hint_y: None
                            height: dp(35)
                            on_press: root.open_score_numpad(1)
                        
                        # CP Buttons for P1 (RESTORED)
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint_y: None
                            height: dp(35)
                            spacing: dp(5)
                            Player1Button:
                                text: "-1 CP"
                                font_size: '14sp'
                                on_press: root.remove_cp(1)
                            InterBlack:
                                text: "CP"
                                font_size: '16sp'
                                size_hint_x: None
                                width: dp(30)
                                halign: 'center'
                                valign: 'middle'
                            Player1Button:
                                text: "+1 CP"
                                font_size: '14sp'
                                on_press: root.add_cp(1)
                BoxLayout:
                    id: p2_panel_id
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(5)
                    InterBlack:
                        id: p2_name_label_id
                        text: 'Player 2'
                        font_size: '24sp'
                        text_size: self.width, None
                        halign: 'right' # Align right as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    InterBlack:
                        id: p2_score_label_id
                        text: '0'
                        font_size: '96sp'
                        text_size: self.width, None
                        halign: 'right' # Align right as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    InterBlack:
                        id: p2_cp_label_id
                        text: 'Command Points: 0'
                        font_size: '18sp'
                        text_size: self.width, None
                        halign: 'right' # Align right as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    InterBlack:
                        id: p2_player_timer_label_id
                        text: '00:00:00'
                        font_size: '18sp'
                        text_size: self.width, None
                        halign: 'right' # Align right as requested
                        valign: 'top'
                        size_hint_y: None
                        height: self.texture_size[1] + dp(5)
                    Player2Button:
                        id: p2_concede_button_id
                        text: "Concede"
                        size_hint_y: None
                        height: dp(35)
                        on_press: root.player_concedes(2)
                        opacity: 0
                        disabled: True
                    Widget:
                        size_hint_y: 1
                    BoxLayout:
                        id: p2_ui_controls_id
                        orientation: 'vertical'
                        spacing: dp(10) 
                        size_hint_y: None
                        height: self.minimum_height 

                        # End Turn button container for P2 (MOVED TO TOP)
                        BoxLayout: 
                            size_hint_y: None
                            height: dp(35)
                            Player2Button:
                                id: p2_end_turn_button_id 
                                text: "End Turn"
                                font_size: '16sp'
                                on_press: root.end_turn()
                                opacity: 0
                                disabled: True

                        Player2Button:
                            id: p2_set_score_button_id
                            text: "Set Score"
                            size_hint_y: None
                            height: dp(35)
                            on_press: root.open_score_numpad(2)

                        # CP Buttons for P2 (RESTORED)
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint_y: None
                            height: dp(35)
                            spacing: dp(5)
                            Player2Button:
                                text: "-1 CP"
                                font_size: '14sp'
                                on_press: root.remove_cp(2)
                            InterBlack:
                                text: "CP"
                                font_size: '16sp'
                                size_hint_x: None
                                width: dp(30)
                                halign: 'center'
                                valign: 'middle'
                            Player2Button:
                                text: "+1 CP"
                                font_size: '14sp'
                                on_press: root.add_cp(2)

        # Free-floating logo, drawn on top. do not remove or change!
        Image:
            source: 'static/logo-original.png'
            size_hint: None, None
            size: dp(128), dp(128)
            pos_hint: {'center_x': 0.5, 'center_y': 0.85}

<GameOverScreen>:
    name: 'game_over'
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            source: 'assets/background.png'
            pos: self.pos
            size: self.size
    result_status_label: result_status_lbl
    p1_final_name_label: p1_name_final_lbl
    p1_final_score_label: p1_score_final_lbl
    p1_final_cp_label: p1_cp_final_lbl
    p1_final_time_label: p1_time_final_lbl
    p2_final_name_label: p2_name_final_lbl
    p2_final_score_label: p2_score_final_lbl
    p2_final_cp_label: p2_cp_final_lbl
    p2_final_time_label: p2_time_final_lbl
    total_game_time_label: total_time_final_lbl
    rounds_played_label: rounds_played_final_lbl
    exit_button: exit_btn_gos

    BoxLayout: # New Main Root
        orientation: 'vertical'
        HeaderLayout:
            title_text: 'Game Over' # Set the property
        # Original Root BoxLayout for GameOverScreen content
        BoxLayout:
            orientation: 'vertical'
            padding: dp(20)
            spacing: dp(10)
            # Old title Label removed from here

            Label:
                id: result_status_lbl
                text: "Determining winner..."
                font_size: '26sp'
                italic: True
                size_hint_y: None
                height: dp(40)
                halign: 'center'

            GridLayout:
                cols: 2
                spacing: dp(10)
                padding: dp(10)
                size_hint_y: 0.6 # Give it some substantial height

                # Player 1 Final Stats
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(5)
                    Label:
                        id: p1_name_final_lbl
                        text: 'Player 1:'
                        font_size: '20sp'
                        bold: True
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p1_score_final_lbl
                        text: 'Score: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p1_cp_final_lbl
                        text: 'CP: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p1_time_final_lbl
                        text: 'Time: 00:00:00'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None

                # Player 2 Final Stats
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(5)
                    Label:
                        id: p2_name_final_lbl
                        text: 'Player 2:'
                        font_size: '20sp'
                        bold: True
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p2_score_final_lbl
                        text: 'Score: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p2_cp_final_lbl
                        text: 'CP: 0'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
                    Label:
                        id: p2_time_final_lbl
                        text: 'Time: 00:00:00'
                        font_size: '18sp'
                        halign: 'left'
                        text_size: self.width, None
            
            Label: # Spacer to push game stats and buttons down a bit
                size_hint_y: 0.1

            # Overall Game Stats
            Label:
                id: total_time_final_lbl
                text: 'Total Game Time: 00:00:00'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'
            Label:
                id: rounds_played_final_lbl
                text: 'Rounds Played: 5'
                font_size: '18sp'
                size_hint_y: None
                height: dp(30)
                halign: 'center'

            Widget: # Spacer
                size_hint_y: 0.3

            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: dp(50)
                spacing: dp(20)
                Button:
                    text: 'Start New Game'
                    font_size: '20sp'
                    on_press: root.start_new_game()
                Button:
                    id: exit_btn_gos
                    text: 'Exit Application'
                    font_size: '20sp'
                    on_press: root.exit_app_from_game_over()

<SplashScreen>:
    name: 'splash_screen'
    loading_indicator: loading_indicator
    start_button: start_button

    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                source: 'assets/background.png'
                pos: self.pos
                size: self.size

        Image:
            source: 'static/logo-original.png'
            fit_mode: 'contain'
            size_hint: None, None
            size: dp(256), dp(256)
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        Label:
            id: loading_indicator
            text: 'Checking network and preparing for launch...'
            font_name: 'InterBlack'
            font_size: '20sp'
            pos_hint: {'center_x': 0.5, 'center_y': 0.25}

        Button:
            id: start_button
            text: 'START'
            font_name: 'InterBlack'
            color: 1, 1, 1, 1 # White text
            font_size: '30sp'
            size_hint: (0.4, None)
            height: dp(60)
            pos_hint: {'center_x': 0.5, 'center_y': 0.123} # Lowered from 0.165
            background_color: 0, 0, 0, 0 # Transparent
            on_press: root.transition_to_next_screen()
            opacity: 0
            disabled: True
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 1 # Black background
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(8)]

<ResumeOrNewScreen>:
    name: 'resume_or_new'
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)
        canvas.before:
            Color:
                rgba: 0.1, 0.1, 0.1, 1
            Rectangle:
                pos: self.pos
                size: self.size

        InterBlack:
            text: 'Game in Progress'
            font_size: '40sp'
            size_hint_y: 0.3

        Label:
            id: resume_info_label
            text: 'A saved game was found. Resume or start a new game?'
            font_size: '20sp'
            size_hint_y: 0.2

        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(20)
            size_hint_y: 0.5

            ScoreboardButton:
                id: resume_button
                text: "Resume Game"
                on_press: root.resume_game_action()

            ScoreboardButton:
                id: new_game_button
                text: "Start New Game"
                on_press: root.start_new_game_from_resume_screen_action()

<ScreensaverScreen>:
    name: 'screensaver'

<WifiRecycleView>:
    viewclass: 'SelectableLabel'
    SelectableGridLayout:
        cols: 1
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<SelectableLabel>:
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (0.2, 0.2, 0.2, 1) if self.selected else (0.1, 0.1, 0.1, 1)
        Rectangle:
            pos: self.pos
            size: self.size 