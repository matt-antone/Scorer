#:kivy 2.3.0

<ScorerRootWidget>:
    # This will be the root of our application's UI
    SplashScreen:
        name: 'splash'
    NameEntryScreen:
        name: 'name_entry'
    DeploymentSetupScreen:
        name: 'deployment_setup'
    InitiativeScreen:
        name: 'initiative'
    ScoreboardScreen:
        name: 'scoreboard'

<HeaderWidget@BoxLayout>:
    size_hint_y: None
    height: '48dp'
    canvas.before:
        Color:
            rgba: 0.2, 0.2, 0.2, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        text: root.title
        font_size: '20sp'
        bold: True

<RoundedButton@Button>:
    background_color: (0.3, 0.3, 0.3, 1) # Default gray color
    background_normal: 'assets/transparent.png'
    background_down: 'assets/transparent.png'
    background_disabled_normal: 'assets/transparent.png'
    background_disabled_down: 'assets/transparent.png'
    canvas.before:
        Color:
            # If the button is disabled, use a darker gray. Otherwise, use its background_color.
            rgba: (0.2, 0.2, 0.2, 1) if self.disabled else self.background_color
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [10]

<SplashScreen>:
    BoxLayout:
        orientation: 'vertical'
        HeaderWidget:
            title: 'Welcome to Scorer'
        BoxLayout:
            orientation: 'vertical'
            padding: '10dp'
            spacing: '10dp'
            Label:
                text: 'Scorer'
                font_size: '50sp'
                bold: True

            Label:
                text: 'A Warhammer 40k Scoreboard'
                font_size: '20sp'

            RoundedButton:
                text: 'START'
                font_size: '20sp'
                size_hint_y: None
                height: '50dp'
                on_press: root.manager.current = 'name_entry'

<NameEntryScreen>:
    BoxLayout:
        orientation: 'vertical'
        HeaderWidget:
            title: 'Enter Player Names'

        BoxLayout:
            orientation: 'horizontal'
            padding: '10dp'
            spacing: '20dp'

            # Player 1 Side
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                Label:
                    text: 'Player 1'
                    font_size: '24sp'
                TextInput:
                    id: player1_name
                    text: "Player 1"
                    hint_text: "Enter Player 1's Name"
                    multiline: False
                    font_size: '20sp'
                    size_hint_y: None
                    height: '40dp'

            # Player 2 Side
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                Label:
                    text: 'Player 2'
                    font_size: '24sp'
                TextInput:
                    id: player2_name
                    text: "Player 2"
                    hint_text: "Enter Player 2's Name"
                    multiline: False
                    font_size: '20sp'
                    size_hint_y: None
                    height: '40dp'
        
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            padding: '10dp'
            RoundedButton:
                text: 'Continue'
                font_size: '20sp'
                size_hint_y: None
                height: '50dp'
                on_press: root.submit_names()

<DeploymentSetupScreen>:
    p1_name_label: p1_name_label
    p2_name_label: p2_name_label
    status_label: status_label
    p1_roll_label: p1_roll_label
    p2_roll_label: p2_roll_label
    p1_roll_button: p1_roll_button
    p2_roll_button: p2_roll_button
    p1_choice_box: p1_choice_box
    p2_choice_box: p2_choice_box

    BoxLayout:
        orientation: 'vertical'
        HeaderWidget:
            title: 'Deployment Roll-Off'

        Label:
            id: status_label
            text: "Players roll to determine Attacker/Defender."
            font_size: '22sp'
            size_hint_y: 0.2

        BoxLayout:
            orientation: 'horizontal'
            padding: '10dp'
            spacing: '20dp'

            # Player 1 Side
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                Label:
                    id: p1_name_label
                    text: 'Player 1' # Default, will be updated
                    font_size: '24sp'
                Label:
                    id: p1_roll_label
                    text: ''
                    font_size: '20sp'

                BoxLayout:
                    id: p1_choice_box
                    orientation: 'vertical'
                    spacing: '10dp'
                    opacity: 0
                    disabled: True
                    RoundedButton:
                        text: 'Attacker'
                        on_press: root.select_role('attacker')
                    RoundedButton:
                        text: 'Defender'
                        on_press: root.select_role('defender')

                RoundedButton:
                    id: p1_roll_button
                    text: 'Roll Die'
                    on_press: root.roll_die(1)
                    size_hint_y: None
                    height: '50dp'

            # Player 2 Side
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                Label:
                    id: p2_name_label
                    text: 'Player 2' # Default, will be updated
                    font_size: '24sp'
                Label:
                    id: p2_roll_label
                    text: ''
                    font_size: '20sp'

                BoxLayout:
                    id: p2_choice_box
                    orientation: 'vertical'
                    spacing: '10dp'
                    opacity: 0
                    disabled: True
                    RoundedButton:
                        text: 'Attacker'
                        on_press: root.select_role('attacker')
                    RoundedButton:
                        text: 'Defender'
                        on_press: root.select_role('defender')

                RoundedButton:
                    id: p2_roll_button
                    text: 'Roll Die'
                    on_press: root.roll_die(2)
                    size_hint_y: None
                    height: '50dp'

<InitiativeScreen>:
    p1_name_label: p1_name_label
    p2_name_label: p2_name_label
    status_label: status_label
    p1_roll_label: p1_roll_label
    p2_roll_label: p2_roll_label
    p1_roll_button: p1_roll_button
    p2_roll_button: p2_roll_button
    p1_choice_box: p1_choice_box
    p2_choice_box: p2_choice_box
    continue_box: continue_box

    BoxLayout:
        orientation: 'vertical'
        HeaderWidget:
            title: 'Initiative Roll'

        Label:
            id: status_label
            text: "Roll for Initiative!"
            font_size: '22sp'
            size_hint_y: 0.2

        BoxLayout:
            orientation: 'horizontal'
            padding: '10dp'
            spacing: '20dp'

            # Player 1 Side
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                Label:
                    id: p1_name_label
                    font_size: '24sp'
                Label:
                    id: p1_roll_label
                    font_size: '20sp'
                BoxLayout:
                    id: p1_choice_box
                    orientation: 'vertical'
                    spacing: '10dp'
                    opacity: 0
                    disabled: True
                    RoundedButton:
                        text: app.game_state.get('p1_name', 'Player 1')
                        on_press: root.select_first_turn(self.text)
                    RoundedButton:
                        text: app.game_state.get('p2_name', 'Player 2')
                        on_press: root.select_first_turn(self.text)
                RoundedButton:
                    id: p1_roll_button
                    text: 'Roll Die'
                    on_press: root.roll_die(1)
                    size_hint_y: None
                    height: '50dp'

            # Player 2 Side
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                Label:
                    id: p2_name_label
                    font_size: '24sp'
                Label:
                    id: p2_roll_label
                    font_size: '20sp'
                BoxLayout:
                    id: p2_choice_box
                    orientation: 'vertical'
                    spacing: '10dp'
                    opacity: 0
                    disabled: True
                    RoundedButton:
                        text: app.game_state.get('p1_name', 'Player 1')
                        on_press: root.select_first_turn(self.text)
                    RoundedButton:
                        text: app.game_state.get('p2_name', 'Player 2')
                        on_press: root.select_first_turn(self.text)
                RoundedButton:
                    id: p2_roll_button
                    text: 'Roll Die'
                    on_press: root.roll_die(2)
                    size_hint_y: None
                    height: '50dp'
        
        FloatLayout:
            size_hint_y: 0.2

            BoxLayout:
                id: continue_box
                size_hint: 1, 1
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                padding: '10dp'
                opacity: 0
                disabled: True
                RoundedButton:
                    text: 'Continue to Game'
                    font_size: '20sp'
                    on_press: root.proceed_to_game()

<ScoreboardScreen>:
    p1_name_label: p1_name_label
    p1_total_score_label: p1_total_score_label
    p1_cp_label: p1_cp_label
    p1_end_turn_button: p1_end_turn_button
    p2_name_label: p2_name_label
    p2_total_score_label: p2_total_score_label
    p2_cp_label: p2_cp_label
    p2_end_turn_button: p2_end_turn_button
    header: header

    BoxLayout:
        orientation: 'vertical'
        HeaderWidget:
            id: header
            title: "Player 1's Turn - Round 1" # Default text

        # Main content area
        BoxLayout:
            orientation: 'horizontal'
            padding: '10dp'
            spacing: '20dp'

            # Player 1 Column
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                RoundedButton:
                    id: p1_end_turn_button
                    text: 'End Turn'
                    size_hint_y: None
                    height: '50dp'
                    on_press: root.end_turn()
                Label:
                    id: p1_name_label
                    text: "Player 1"
                    font_size: '24sp'
                    size_hint_y: 0.15
                Label:
                    id: p1_total_score_label
                    text: '0'
                    font_size: '100sp'
                    bold: True
                Label:
                    text: 'Command Points'
                    size_hint_y: 0.1
                BoxLayout:
                    size_hint_y: 0.2
                    RoundedButton:
                        text: '-'
                        on_press: root.change_cp(1, -1)
                    Label:
                        id: p1_cp_label
                        text: '0'
                        font_size: '30sp'
                        bold: True
                    RoundedButton:
                        text: '+'
                        on_press: root.change_cp(1, 1)
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: '10dp'
                    RoundedButton:
                        text: 'Primary'
                        on_press: root.open_score_popup(1, 'primary')
                    RoundedButton:
                        text: 'Secondary'
                        on_press: root.open_score_popup(1, 'secondary')

            # Player 2 Column
            BoxLayout:
                orientation: 'vertical'
                spacing: '10dp'
                RoundedButton:
                    id: p2_end_turn_button
                    text: 'End Turn'
                    size_hint_y: None
                    height: '50dp'
                    on_press: root.end_turn()
                Label:
                    id: p2_name_label
                    text: "Player 2"
                    font_size: '24sp'
                    size_hint_y: 0.15
                Label:
                    id: p2_total_score_label
                    text: '0'
                    font_size: '100sp'
                    bold: True
                Label:
                    text: 'Command Points'
                    size_hint_y: 0.1
                BoxLayout:
                    size_hint_y: 0.2
                    RoundedButton:
                        text: '-'
                        on_press: root.change_cp(2, -1)
                    Label:
                        id: p2_cp_label
                        text: '0'
                        font_size: '30sp'
                        bold: True
                    RoundedButton:
                        text: '+'
                        on_press: root.change_cp(2, 1)
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: '10dp'
                    RoundedButton:
                        text: 'Primary'
                        on_press: root.open_score_popup(2, 'primary')
                    RoundedButton:
                        text: 'Secondary'
                        on_press: root.open_score_popup(2, 'secondary')

<NumberPadPopup@Popup>:
    size_hint: None, None
    size: '220dp', '280dp'
    auto_dismiss: False
    input_box: input_box

    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'

        TextInput:
            id: input_box
            multiline: False
            readonly: True
            font_size: '32sp'
            size_hint_y: 0.2
            hint_text: "0"

        GridLayout:
            cols: 3
            spacing: '10dp'

            RoundedButton:
                text: '1'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '2'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '3'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '4'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '5'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '6'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '7'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '8'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: '9'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: 'C'
                background_color: 1, 0, 0, 1 # Red
                on_press: root.on_clear_press()
            RoundedButton:
                text: '0'
                on_press: root.on_button_press(self)
            RoundedButton:
                text: 'OK'
                background_color: 0, 1, 0, 1 # Green
                on_press: root.on_ok_press() 